from machine import Pin, I2C, ADC 
import i2c_lcd
import time

# potentiometer and i2c setup
potentiometer = ADC(Pin(34))
potentiometer.ATTN_11DB 

i2c_device = I2C(0, scl=Pin(22), sda=Pin(21))
lcd = i2c_lcd.I2cLcd(i2c_device, 0x27, 2, 16)

old_max = 0
old_min = 4095

# button set up
button = Pin(13, Pin.IN, Pin.PULL_UP)

last_press_time = 0
debounce_interval = 200
press = False

def handle_interrupt(pin):
    global last_press_time, press
    current_time = time.ticks_ms()
    
    # Check if enough time has passed since last valid press
    if time.ticks_diff(current_time, last_press_time) > debounce_interval:
        press = True
        last_press_time = current_time

button.irq(trigger=Pin.IRQ_FALLING, handler=handle_interrupt)

# reading
while True:
    new_reading = potentiometer.read()
    lcd.move_to(0,0)
    lcd.putstr('reading: %d  ' % new_reading)
    if new_reading > old_max:
        lcd.move_to(0,1)
        lcd.putstr(f'mx {new_reading}')
        old_max = new_reading
    if new_reading < old_min:
        lcd.move_to(8,1)
        lcd.putstr(f'mn {new_reading}  ')
        old_min = new_reading  
        
    if press == True:
        press = False
        old_max = 0
        old_min = 4095
        lcd.move_to(0, 1)
        lcd.putstr(" " * 16)
        lcd.move_to(0,1)
        lcd.putstr(f'mx {old_max}')
        lcd.move_to(8,1)
        lcd.putstr('mn 0')   
        
    time.sleep(1) 
